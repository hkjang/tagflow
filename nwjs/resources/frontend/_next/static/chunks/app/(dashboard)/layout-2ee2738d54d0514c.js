(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[642],{7406:function(e,t,r){Promise.resolve().then(r.bind(r,2955))},2955:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return g}});var n=r(7821),o=r(6871),s=r.n(o),a=r(6179),i=r(1981);function l(){let e=(0,a.usePathname)(),{user:t}=(0,i.a)(),r=(null==t?void 0:t.role)==="admin",o=[{name:"Dashboard",href:"/dashboard",icon:"\uD83D\uDCCA"},...r?[{name:"User Management",href:"/admin/users",icon:"\uD83D\uDC65"}]:[],{name:"Tag Management",href:"/tags",icon:"\uD83C\uDFF7️"},{name:"Tag Input",href:"/scan",icon:"\uD83D\uDCF1"},{name:"Reports",href:"/reports",icon:"\uD83D\uDCC8"},...r?[{name:"Settings",href:"/settings",icon:"⚙️"}]:[]];return(0,n.jsxs)("aside",{style:{width:"250px",backgroundColor:"#1f2937",color:"white",height:"100vh",display:"flex",flexDirection:"column",position:"fixed",left:0,top:0},children:[(0,n.jsx)("div",{style:{padding:"1.5rem",borderBottom:"1px solid #374151"},children:(0,n.jsx)("h1",{style:{fontSize:"1.5rem",fontWeight:"bold"},children:"TagFlow"})}),(0,n.jsx)("nav",{style:{flex:1,padding:"1rem"},children:(0,n.jsx)("ul",{style:{listStyle:"none",padding:0,margin:0},children:o.map(t=>{let r=e===t.href;return(0,n.jsx)("li",{style:{marginBottom:"0.5rem"},children:(0,n.jsxs)(s(),{href:t.href,style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",borderRadius:"0.375rem",textDecoration:"none",color:r?"white":"#9ca3af",backgroundColor:r?"#374151":"transparent",transition:"all 0.2s"},children:[(0,n.jsx)("span",{style:{marginRight:"0.75rem"},children:t.icon}),t.name]})},t.href)})})}),(0,n.jsx)("div",{style:{padding:"1rem",borderTop:"1px solid #374151"},children:(0,n.jsxs)("div",{style:{fontSize:"0.875rem",color:"#9ca3af"},children:["Logged in as: ",(0,n.jsx)("br",{}),(0,n.jsx)("strong",{style:{color:"white"},children:null==t?void 0:t.username})]})})]})}function d(e){let{children:t}=e,{logout:r}=(0,i.a)(),o=(0,a.useRouter)();return(0,n.jsxs)("div",{style:{minHeight:"100vh",backgroundColor:"#f3f4f6"},children:[(0,n.jsx)(l,{}),(0,n.jsxs)("div",{style:{marginLeft:"250px",display:"flex",flexDirection:"column",minHeight:"100vh"},children:[(0,n.jsx)("header",{style:{backgroundColor:"white",padding:"1rem 2rem",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",display:"flex",justifyContent:"flex-end",alignItems:"center"},children:(0,n.jsx)("button",{onClick:()=>{r(),o.push("/login")},style:{padding:"0.5rem 1rem",fontSize:"0.875rem",color:"#ef4444",backgroundColor:"#fee2e2",border:"none",borderRadius:"0.375rem",cursor:"pointer",fontWeight:"500"},children:"Sign out"})}),(0,n.jsx)("main",{style:{flex:1,padding:"2rem"},children:t})]})]})}var c=r(8397),u=r.n(c),f=r(8078);function h(e){let{children:t}=e,r=(0,a.useRouter)(),{isAuthenticated:o,isLoading:s}=(0,i.a)();return((0,f.useEffect)(()=>{s||o||r.push("/login")},[o,s,r]),s)?(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh",fontFamily:"system-ui, -apple-system, sans-serif"},className:"jsx-7a90291f0de70b21",children:[(0,n.jsxs)("div",{style:{textAlign:"center"},className:"jsx-7a90291f0de70b21",children:[(0,n.jsx)("div",{style:{width:"50px",height:"50px",border:"4px solid #e5e7eb",borderTop:"4px solid #2563eb",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 1rem"},className:"jsx-7a90291f0de70b21"}),(0,n.jsx)("p",{style:{color:"#6b7280"},className:"jsx-7a90291f0de70b21",children:"Loading..."})]}),(0,n.jsx)(u(),{id:"7a90291f0de70b21",children:"@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes spin{0%{-moz-transform:rotate(0deg);transform:rotate(0deg)}100%{-moz-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes spin{0%{-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{0%{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}"})]}):o?(0,n.jsx)(n.Fragment,{children:t}):null}function g(e){let{children:t}=e;return(0,n.jsx)(h,{children:(0,n.jsx)(d,{children:t})})}},1981:function(e,t,r){"use strict";r.d(t,{a:function(){return a}});var n=r(8433),o=r(2076);let s={login:async e=>(await o.Z.post("/auth/login",e)).data,refreshToken:async e=>(await o.Z.post("/auth/refresh",{refresh_token:e})).data,getCurrentUser:async()=>(await o.Z.get("/auth/me")).data,logout(){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}},a=(0,n.Ue)((e,t)=>({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,isLoading:!0,setTokens:(t,r)=>{localStorage.setItem("access_token",t),localStorage.setItem("refresh_token",r),e({accessToken:t,refreshToken:r,isAuthenticated:!0})},setUser:t=>{e({user:t,isAuthenticated:!!t})},setLoading:t=>{e({isLoading:t})},login:async(r,n)=>{try{e({isLoading:!0});let o=await s.login({username:r,password:n});t().setTokens(o.access_token,o.refresh_token),e({user:o.user,isAuthenticated:!0})}catch(e){throw console.error("Login failed:",e),e}finally{e({isLoading:!1})}},logout:()=>{s.logout(),e({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1})},refreshUser:async()=>{try{e({isLoading:!0});let t=await s.getCurrentUser();e({user:t,isAuthenticated:!0})}catch(e){console.error("Failed to refresh user:",e),t().logout()}finally{e({isLoading:!1})}}}));{let e=localStorage.getItem("access_token"),t=localStorage.getItem("refresh_token");e&&t?(a.setState({accessToken:e,refreshToken:t,isAuthenticated:!0,isLoading:!0}),a.getState().refreshUser()):a.setState({isLoading:!1})}},2076:function(e,t,r){"use strict";var n=r(1892);let o=r(9792).env.NEXT_PUBLIC_API_URL||"http://localhost:3001",s=n.Z.create({baseURL:o,headers:{"Content-Type":"application/json"}});s.interceptors.request.use(e=>{let t=localStorage.getItem("access_token");return t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),s.interceptors.response.use(e=>e,async e=>{var t,r,a;let i=e.config,l=(null===(t=i.url)||void 0===t?void 0:t.includes("/auth/login"))||(null===(r=i.url)||void 0===r?void 0:r.includes("/auth/refresh")),d=localStorage.getItem("refresh_token");if((null===(a=e.response)||void 0===a?void 0:a.status)===401&&!i._retry&&!l&&d){i._retry=!0;try{let{access_token:e,refresh_token:t}=(await n.Z.post("".concat(o,"/auth/refresh"),{refresh_token:d})).data;return localStorage.setItem("access_token",e),localStorage.setItem("refresh_token",t),i.headers&&(i.headers.Authorization="Bearer ".concat(e)),s(i)}catch(e){return localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),window.location.href="/login",Promise.reject(e)}}return Promise.reject(e)}),t.Z=s}},function(e){e.O(0,[885,113,871,115,141,744],function(){return e(e.s=7406)}),_N_E=e.O()}]);