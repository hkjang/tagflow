(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[960],{5573:function(e,t,r){Promise.resolve().then(r.bind(r,2484))},2484:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return o}});var s=r(7821),a=r(8078),l=r(2076);let n={async getEventStatistics(e,t){let r=new URLSearchParams;return e&&r.append("startDate",e),t&&r.append("endDate",t),(await l.Z.get("/reports/events?".concat(r.toString()))).data},getWebhookStatistics:async()=>(await l.Z.get("/reports/webhooks")).data,async exportEvents(e,t){let r=new URLSearchParams;return e&&r.append("startDate",e),t&&r.append("endDate",t),(await l.Z.get("/reports/export?".concat(r.toString()))).data}};function o(){var e,t,r;let[l,o]=(0,a.useState)(null),[i,d]=(0,a.useState)(null),[c,h]=(0,a.useState)(!0),[p,x]=(0,a.useState)(null),[u,g]=(0,a.useState)("30days"),[m,y]=(0,a.useState)(""),[b,v]=(0,a.useState)(""),[f,j]=(0,a.useState)(!1),S=()=>{let e;let t=new Date;switch(u){case"7days":e=new Date(t.getTime()-6048e5);break;case"30days":default:e=new Date(t.getTime()-2592e6);break;case"90days":e=new Date(t.getTime()-7776e6);break;case"custom":return{startDate:m||void 0,endDate:b||void 0}}return{startDate:e.toISOString().split("T")[0],endDate:t.toISOString().split("T")[0]}},C=async()=>{try{h(!0),x(null);let{startDate:e,endDate:t}=S(),[r,s]=await Promise.all([n.getEventStatistics(e,t),n.getWebhookStatistics()]);o(r),d(s)}catch(r){var e,t;console.error("Failed to fetch reports:",r),x((null===(t=r.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"Failed to load reports")}finally{h(!1)}};(0,a.useEffect)(()=>{C()},[u,m,b]);let w=async()=>{try{j(!0);let{startDate:e,endDate:t}=S(),r=(await n.exportEvents(e,t)).map(e=>[e.id,e.card_uid,e.event_time,e.device_id||"",e.is_manual?"Yes":"No",e.created_at]),s=[["ID","Card UID","Event Time","Device ID","Is Manual","Created At"],...r].map(e=>e.join(",")).join("\n"),a=new Blob([s],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(a),o=document.createElement("a");o.href=l,o.download="tag-events-".concat(new Date().toISOString().split("T")[0],".csv"),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(l)}catch(e){console.error("Failed to export:",e),alert("Failed to export events")}finally{j(!1)}},k=(null==l?void 0:null===(e=l.eventsByDay)||void 0===e?void 0:e.length)?Math.max(...l.eventsByDay.map(e=>e.count),1):1,_={container:{padding:"0"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rem",flexWrap:"wrap",gap:"1rem"},title:{fontSize:"1.875rem",fontWeight:"bold",color:"#1f2937",margin:0},controls:{display:"flex",gap:"0.75rem",alignItems:"center",flexWrap:"wrap"},select:{padding:"0.5rem 1rem",borderRadius:"0.5rem",border:"1px solid #d1d5db",backgroundColor:"white",fontSize:"0.875rem",cursor:"pointer"},dateInput:{padding:"0.5rem",borderRadius:"0.5rem",border:"1px solid #d1d5db",fontSize:"0.875rem"},exportBtn:{padding:"0.5rem 1rem",borderRadius:"0.5rem",border:"none",backgroundColor:"#10b981",color:"white",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem"},grid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1.5rem",marginBottom:"2rem"},statCard:{backgroundColor:"white",padding:"1.5rem",borderRadius:"0.75rem",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1)",border:"1px solid #e5e7eb"},statLabel:{fontSize:"0.875rem",color:"#6b7280",marginBottom:"0.5rem"},statValue:{fontSize:"2rem",fontWeight:"bold",color:"#1f2937"},statSubtext:{fontSize:"0.75rem",color:"#9ca3af",marginTop:"0.25rem"},section:{backgroundColor:"white",padding:"1.5rem",borderRadius:"0.75rem",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1)",border:"1px solid #e5e7eb",marginBottom:"1.5rem"},sectionTitle:{fontSize:"1.125rem",fontWeight:"600",marginBottom:"1rem",color:"#374151"},chartContainer:{height:"250px",position:"relative"},barContainer:{display:"flex",alignItems:"flex-end",justifyContent:"space-between",height:"100%",gap:"4px",padding:"0 0.5rem"},barWrapper:{display:"flex",flexDirection:"column",alignItems:"center",flex:1,maxWidth:"40px",height:"100%"},bar:{width:"100%",backgroundColor:"#3b82f6",borderRadius:"4px 4px 0 0",transition:"height 0.3s ease",minHeight:"2px"},barLabel:{fontSize:"0.625rem",color:"#6b7280",marginTop:"0.25rem",transform:"rotate(-45deg)",transformOrigin:"top left",whiteSpace:"nowrap"},table:{width:"100%",borderCollapse:"collapse",fontSize:"0.875rem"},th:{textAlign:"left",padding:"0.75rem",backgroundColor:"#f9fafb",borderBottom:"1px solid #e5e7eb",color:"#374151",fontWeight:"600"},td:{padding:"0.75rem",borderBottom:"1px solid #e5e7eb",color:"#4b5563"},badge:{display:"inline-block",padding:"0.25rem 0.75rem",borderRadius:"9999px",fontSize:"0.75rem",fontWeight:"500"},successBadge:{backgroundColor:"#d1fae5",color:"#065f46"},errorBadge:{backgroundColor:"#fee2e2",color:"#991b1b"},emptyState:{padding:"3rem",textAlign:"center",color:"#6b7280"},loadingContainer:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},spinner:{width:"40px",height:"40px",border:"3px solid #e5e7eb",borderTop:"3px solid #3b82f6",borderRadius:"50%",animation:"spin 1s linear infinite"},twoColumn:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(400px, 1fr))",gap:"1.5rem"},progressBar:{height:"8px",backgroundColor:"#e5e7eb",borderRadius:"4px",overflow:"hidden",marginTop:"0.5rem"},progressFill:{height:"100%",borderRadius:"4px",transition:"width 0.3s ease"}};return c?(0,s.jsxs)("div",{style:_.container,children:[(0,s.jsx)("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"}),(0,s.jsx)("div",{style:_.loadingContainer,children:(0,s.jsx)("div",{style:_.spinner})})]}):p?(0,s.jsx)("div",{style:_.container,children:(0,s.jsxs)("div",{style:{..._.section,textAlign:"center",padding:"3rem"},children:[(0,s.jsx)("p",{style:{color:"#ef4444",marginBottom:"1rem"},children:p}),(0,s.jsx)("button",{onClick:C,style:{..._.exportBtn,backgroundColor:"#3b82f6"},children:"Retry"})]})}):(0,s.jsxs)("div",{style:_.container,children:[(0,s.jsx)("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"}),(0,s.jsxs)("div",{style:_.header,children:[(0,s.jsx)("h1",{style:_.title,children:"Reports & Analytics"}),(0,s.jsxs)("div",{style:_.controls,children:[(0,s.jsxs)("select",{value:u,onChange:e=>g(e.target.value),style:_.select,children:[(0,s.jsx)("option",{value:"7days",children:"Last 7 Days"}),(0,s.jsx)("option",{value:"30days",children:"Last 30 Days"}),(0,s.jsx)("option",{value:"90days",children:"Last 90 Days"}),(0,s.jsx)("option",{value:"custom",children:"Custom Range"})]}),"custom"===u&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("input",{type:"date",value:m,onChange:e=>y(e.target.value),style:_.dateInput,placeholder:"Start Date"}),(0,s.jsx)("span",{style:{color:"#6b7280"},children:"to"}),(0,s.jsx)("input",{type:"date",value:b,onChange:e=>v(e.target.value),style:_.dateInput,placeholder:"End Date"})]}),(0,s.jsx)("button",{onClick:w,disabled:f,style:{..._.exportBtn,opacity:f?.7:1},children:f?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{style:{..._.spinner,width:"16px",height:"16px",borderWidth:"2px"}}),"Exporting..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,s.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,s.jsx)("polyline",{points:"7 10 12 15 17 10"}),(0,s.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"Export CSV"]})})]})]}),(0,s.jsxs)("div",{style:_.grid,children:[(0,s.jsxs)("div",{style:_.statCard,children:[(0,s.jsx)("div",{style:_.statLabel,children:"Total Events"}),(0,s.jsx)("div",{style:_.statValue,children:(null==l?void 0:null===(t=l.total)||void 0===t?void 0:t.toLocaleString())||0}),(0,s.jsx)("div",{style:_.statSubtext,children:"Tag scans recorded"})]}),(0,s.jsxs)("div",{style:_.statCard,children:[(0,s.jsx)("div",{style:_.statLabel,children:"Unique Cards"}),(0,s.jsx)("div",{style:_.statValue,children:(null==l?void 0:null===(r=l.unique_cards)||void 0===r?void 0:r.toLocaleString())||0}),(0,s.jsx)("div",{style:_.statSubtext,children:"Different cards detected"})]}),(0,s.jsxs)("div",{style:_.statCard,children:[(0,s.jsx)("div",{style:_.statLabel,children:"Active Webhooks"}),(0,s.jsx)("div",{style:{..._.statValue,color:"#10b981"},children:(null==i?void 0:i.activeWebhooks)||0}),(0,s.jsxs)("div",{style:_.statSubtext,children:["of ",(null==i?void 0:i.totalWebhooks)||0," total"]})]}),(0,s.jsxs)("div",{style:_.statCard,children:[(0,s.jsx)("div",{style:_.statLabel,children:"Webhook Success Rate"}),(0,s.jsxs)("div",{style:{..._.statValue,color:i&&i.total_calls>0?i.successful_calls/i.total_calls>=.9?"#10b981":"#f59e0b":"#6b7280"},children:[i&&i.total_calls>0?Math.round(i.successful_calls/i.total_calls*100):0,"%"]}),(0,s.jsxs)("div",{style:_.statSubtext,children:[(null==i?void 0:i.successful_calls)||0," / ",(null==i?void 0:i.total_calls)||0," calls (30 days)"]})]})]}),(0,s.jsxs)("div",{style:_.twoColumn,children:[(0,s.jsxs)("div",{style:_.section,children:[(0,s.jsx)("h2",{style:_.sectionTitle,children:"Daily Event Activity"}),(null==l?void 0:l.eventsByDay)&&l.eventsByDay.length>0?(0,s.jsx)("div",{style:_.chartContainer,children:(0,s.jsx)("div",{style:_.barContainer,children:l.eventsByDay.slice().reverse().map((e,t)=>(0,s.jsxs)("div",{style:_.barWrapper,title:"".concat(e.date,": ").concat(e.count," events"),children:[(0,s.jsx)("div",{style:{..._.bar,height:"".concat(Math.max(e.count/k*200,2),"px")}}),(0,s.jsx)("span",{style:_.barLabel,children:new Date(e.date).toLocaleDateString("en",{month:"short",day:"numeric"})})]},t))})}):(0,s.jsx)("div",{style:_.emptyState,children:"No event data available for this period"})]}),(0,s.jsxs)("div",{style:_.section,children:[(0,s.jsx)("h2",{style:_.sectionTitle,children:"Most Active Cards"}),(null==l?void 0:l.topCards)&&l.topCards.length>0?(0,s.jsxs)("table",{style:_.table,children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{style:_.th,children:"Card UID"}),(0,s.jsx)("th",{style:{..._.th,textAlign:"right"},children:"Event Count"})]})}),(0,s.jsx)("tbody",{children:l.topCards.map((e,t)=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{style:_.td,children:(0,s.jsx)("code",{style:{backgroundColor:"#f3f4f6",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.8125rem"},children:e.card_uid})}),(0,s.jsx)("td",{style:{..._.td,textAlign:"right",fontWeight:"500"},children:e.count.toLocaleString()})]},t))})]}):(0,s.jsx)("div",{style:_.emptyState,children:"No card data available"})]})]}),(0,s.jsxs)("div",{style:_.section,children:[(0,s.jsx)("h2",{style:_.sectionTitle,children:"Webhook Performance (Last 30 Days)"}),(null==i?void 0:i.webhookPerformance)&&i.webhookPerformance.length>0?(0,s.jsxs)("table",{style:_.table,children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{style:_.th,children:"Webhook"}),(0,s.jsx)("th",{style:{..._.th,textAlign:"center"},children:"Total Calls"}),(0,s.jsx)("th",{style:{..._.th,textAlign:"center"},children:"Successful"}),(0,s.jsx)("th",{style:{..._.th,textAlign:"center"},children:"Failed"}),(0,s.jsx)("th",{style:{..._.th,textAlign:"right"},children:"Success Rate"})]})}),(0,s.jsx)("tbody",{children:i.webhookPerformance.map(e=>{let t=e.total_calls>0?Math.round(e.successful_calls/e.total_calls*100):0,r=t>=90;return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{style:_.td,children:e.name}),(0,s.jsx)("td",{style:{..._.td,textAlign:"center"},children:e.total_calls}),(0,s.jsx)("td",{style:{..._.td,textAlign:"center"},children:(0,s.jsx)("span",{style:{..._.badge,..._.successBadge},children:e.successful_calls})}),(0,s.jsx)("td",{style:{..._.td,textAlign:"center"},children:e.failed_calls>0?(0,s.jsx)("span",{style:{..._.badge,..._.errorBadge},children:e.failed_calls}):(0,s.jsx)("span",{style:{color:"#9ca3af"},children:"0"})}),(0,s.jsx)("td",{style:{..._.td,textAlign:"right"},children:(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:"0.5rem"},children:[(0,s.jsx)("div",{style:{..._.progressBar,width:"80px"},children:(0,s.jsx)("div",{style:{..._.progressFill,width:"".concat(t,"%"),backgroundColor:r?"#10b981":"#f59e0b"}})}),(0,s.jsxs)("span",{style:{fontWeight:"500",color:r?"#10b981":"#f59e0b"},children:[t,"%"]})]})})]},e.id)})})]}):(0,s.jsx)("div",{style:_.emptyState,children:"No webhook performance data available"})]})]})}},2076:function(e,t,r){"use strict";var s=r(1892);let a=r(9792).env.NEXT_PUBLIC_API_URL||"http://localhost:3001",l=s.Z.create({baseURL:a,headers:{"Content-Type":"application/json"}});l.interceptors.request.use(e=>{let t=localStorage.getItem("access_token");return t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),l.interceptors.response.use(e=>e,async e=>{var t,r,n;let o=e.config,i=(null===(t=o.url)||void 0===t?void 0:t.includes("/auth/login"))||(null===(r=o.url)||void 0===r?void 0:r.includes("/auth/refresh")),d=localStorage.getItem("refresh_token");if((null===(n=e.response)||void 0===n?void 0:n.status)===401&&!o._retry&&!i&&d){o._retry=!0;try{let{access_token:e,refresh_token:t}=(await s.Z.post("".concat(a,"/auth/refresh"),{refresh_token:d})).data;return localStorage.setItem("access_token",e),localStorage.setItem("refresh_token",t),o.headers&&(o.headers.Authorization="Bearer ".concat(e)),l(o)}catch(e){return localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),window.location.href="/login",Promise.reject(e)}}return Promise.reject(e)}),t.Z=l}},function(e){e.O(0,[885,115,141,744],function(){return e(e.s=5573)}),_N_E=e.O()}]);