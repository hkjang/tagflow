# 웹훅 로그

웹훅 실행 기록을 조회하고 분석하는 방법을 안내합니다.

```
⚠️ 읽기 전용
운영자는 웹훅 로그를 조회만 할 수 있습니다.
웹훅 설정 변경은 관리자만 가능합니다.
```

## 웹훅 로그 페이지 접근

1. 사이드바에서 **"웹훅 로그"** 클릭
2. 모든 웹훅 실행 기록이 표시됩니다

## 웹훅이란?

운영자로서 웹훅의 기본 개념을 이해하면 로그 해석에 도움이 됩니다.

**웹훅의 역할**:

```
RFID 태그 스캔 → TagFlow → 웹훅 → 외부 시스템
```

예시:

- ERP 시스템: 재고 자동 업데이트
- Slack: 실시간 알림 전송
- 백업 서버: 데이터 동기화

## 로그 목록 이해하기

### 표시되는 정보

각 웹훅 로그는 다음 정보를 포함합니다:

| 필드          | 설명                | 예시                |
| ------------- | ------------------- | ------------------- |
| **시간**      | 웹훅 실행 시각      | 2025-12-03 14:30:25 |
| **웹훅 이름** | 대상 웹훅 식별 이름 | ERP 재고 업데이트   |
| **상태**      | 성공/실패           | ✅ 성공 / ❌ 실패   |
| **HTTP 코드** | 응답 상태 코드      | 200, 404, 500 등    |
| **응답 시간** | 전송 속도           | 145ms               |
| **재시도**    | 재시도 횟수         | 0, 1, 2 등          |

### 상태 표시

**성공 (✅)**:

```
HTTP 200-299 범위
데이터가 성공적으로 전달됨
```

**실패 (❌)**:

```
HTTP 400-599 범위 또는 네트워크 오류
데이터 전달 실패, 재시도 가능
```

**진행 중 (⏳)**:

```
현재 전송 중 또는 재시도 대기 중
```

## HTTP 상태 코드 이해

### 성공 코드 (2xx)

| 코드    | 의미       | 설명                  |
| ------- | ---------- | --------------------- |
| **200** | OK         | 정상 처리 완료        |
| **201** | Created    | 새 리소스 생성 성공   |
| **204** | No Content | 성공 (응답 본문 없음) |

**해석**: 모두 정상입니다.

### 클라이언트 오류 (4xx)

| 코드    | 의미         | 가능한 원인        |
| ------- | ------------ | ------------------ |
| **400** | Bad Request  | 잘못된 데이터 형식 |
| **401** | Unauthorized | 인증 실패          |
| **403** | Forbidden    | 권한 없음          |
| **404** | Not Found    | URL 경로 오류      |

**조치**: 관리자에게 웹훅 설정 확인 요청

### 서버 오류 (5xx)

| 코드    | 의미                  | 가능한 원인         |
| ------- | --------------------- | ------------------- |
| **500** | Internal Server Error | 외부 서버 내부 오류 |
| **502** | Bad Gateway           | 게이트웨이 문제     |
| **503** | Service Unavailable   | 서비스 일시 중지    |
| **504** | Gateway Timeout       | 응답 시간 초과      |

**조치**: 외부 시스템 담당자에게 문의 (관리자 통해)

## 로그 검색 및 필터링

### 웹훅별 필터

특정 웹훅의 로그만 보려면:

1. **웹훅 필터** 드롭다운 클릭
2. 원하는 웹훅 선택
   ```
   예: "ERP 재고 업데이트"
   ```
3. 해당 웹훅의 로그만 표시됨

### 상태별 필터

성공 또는 실패만 보려면:

1. **상태 필터** 선택
2. 옵션:
   - 전체
   - 성공만
   - 실패만
3. 선택한 상태의 로그만 표시됨

### 날짜 범위 필터

특정 기간의 로그만 보려면:

1. **날짜 필터** 클릭
2. 시작/종료 날짜 선택
3. **"적용"** 버튼 클릭

### 태그 UID로 검색

특정 태그 이벤트로 인한 웹훅을 찾으려면:

1. 검색창에 태그 UID 입력
   ```
   예: TAG_AB123456
   ```
2. 해당 태그로 트리거된 웹훅 로그만 표시

## 로그 상세 정보

### 상세 보기

특정 로그의 전체 정보를 보려면:

1. 로그 행 클릭
2. 상세 정보 패널 표시

### 상세 정보 내용

**요청 정보**:

- 웹훅명
- 대상 URL
- HTTP 메서드 (POST/PUT)
- 전송 시간

**응답 정보**:

- 상태 코드
- 응답 시간 (밀리초)
- 응답 본문 (일부)

**이벤트 정보**:

- 트리거한 태그 UID
- 이벤트 ID
- 이벤트 타임스탬프

**전송 데이터**:

```json
{
  "tagId": "TAG_AB123456",
  "timestamp": "2025-12-03T14:30:25Z",
  "deviceId": "READER_01",
  "location": "창고 A동"
}
```

**오류 정보** (실패 시):

- 오류 메시지
- 오류 코드
- 재시도 횟수

## 웹훅 성능 분석

### 응답 시간

**응답 시간 기준**:

- 🟢 우수: <100ms
- 🟡 양호: 100~300ms
- 🟠 주의: 300~1000ms
- 🔴 경고: >1000ms

**느린 웹훅 식별**:

1. 응답 시간으로 정렬
2. 1000ms 이상 로그 확인
3. 관리자에게 성능 이슈 보고

### 성공률

**웹훅별 성공률 계산**:

```
성공률 = (성공 횟수 / 전체 시도 횟수) × 100%
```

**정상 범위**:

- 95% 이상: 우수
- 90~95%: 양호
- 90% 미만: 문제 있음

### 재시도 패턴

**재시도 횟수 확인**:

```
재시도 0회: 첫 시도에 성공
재시도 1~3회: 일시적 문제 후 성공
재시도 >3회: 지속적 문제
```

**주의가 필요한 패턴**:

```
⚠️ 모든 로그가 재시도 3회
→ 외부 시스템 문제 가능성
```

## 문제 해결 가이드

### 지속적인 실패

**증상**: 특정 웹훅이 계속 실패합니다.

**확인 단계**:

1. **상태 코드 확인**

   ```
   4xx: 설정 문제 → 관리자에게 웹훅 설정 확인 요청
   5xx: 외부 서버 문제 → 외부 시스템 담당자 확인
   타임아웃: 성능 문제 → 외부 시스템 성능 점검
   ```

2. **패턴 확인**

   ```
   - 특정 시간대만 실패?
   - 모든 웹훅 실패 vs 특정 웹훅만?
   - 최근 변경사항이 있었나?
   ```

3. **관리자 보고**
   ```
   - 웹훅명
   - 실패 시작 시간
   - 상태 코드
   - 오류 메시지
   - 발생 빈도
   ```

### 간헐적 실패

**증상**: 가끔씩만 실패합니다.

**분석**:

```
- 재시도 후 성공하면 → 일시적 네트워크 문제 (정상)
- 패턴이 있으면 (예: 매일 14시) → 외부 시스템 부하 확인
- 무작위 실패 → 네트워크 품질 점검
```

### 응답 시간 증가

**증상**: 웹훅 응답 시간이 점점 길어집니다.

**조치**:

```
1. 여러 웹훅이 동시에 느려지면 → TagFlow 서버 확인
2. 특정 웹훅만 느리면 → 외부 시스템 성능 확인
3. 관리자에게 트렌드 공유
```

## 모니터링 체크리스트

### 일일 점검

- [ ] **전체 성공률 확인**

  ```
  95% 이상 유지되는지 확인
  ```

- [ ] **최근 실패 검토**

  ```
  최근 1시간 내 실패 로그 확인
  ```

- [ ] **응답 시간 확인**
  ```
  평균 응답 시간이 정상 범위인지 확인
  ```

### 주간 점검

- [ ] **웹훅별 성능 분석**

  ```
  각 웹훅의 성공률과 응답 시간 검토
  ```

- [ ] **실패 패턴 식별**

  ```
  반복적인 실패 원인 분석
  ```

- [ ] **트렌드 파악**
  ```
  성능 개선/악화 추세 확인
  ```

## 로그 활용 사례

### 사례 1: 웹훅 성능 검증

**목표**: 새로 설정된 웹훅이 정상 작동하는지 확인

**단계**:

1. 웹훅 로그 페이지 접속
2. 해당 웹훅 필터 적용
3. 최근 1시간 로그 검토
4. 성공률과 응답 시간 확인

**판단**:

```
성공률 95% 이상, 응답시간 300ms 이하 → 정상
그 외 → 관리자에게 보고
```

### 사례 2: 특정 태그 추적

**목표**: 특정 태그의 웹훅 전송 기록 확인

**단계**:

1. 검색창에 태그 UID 입력
2. 해당 태그의 모든 웹훅 로그 확인
3. 각 웹훅 전송 성공 여부 검증

**활용**:

```
중요한 물품의 데이터가 외부 시스템에 제대로 전달되었는지 확인
```

### 사례 3: 문제 시간대 식별

**목표**: 오류가 집중되는 시간대 파악

**단계**:

1. 상태 필터를 "실패만"으로 설정
2. 날짜 범위를 최근 7일로 설정
3. 실패 로그의 시간 패턴 분석

**발견 가능**:

```
- 매일 특정 시간 실패 → 외부 시스템 유지보수 시간
- 피크 시간 실패 → 부하 문제
```

## 운영자 권한 제한

운영자는 다음 작업을 **할 수 없습니다**:

❌ 웹훅 생성/편집/삭제  
❌ 웹훅 테스트 실행  
❌ 웹훅 활성화/비활성화  
❌ 재시도 설정 변경  
❌ 로그 삭제

이러한 작업이 필요하면 관리자에게 요청하세요.

## 관련 문서

- [웹훅 설정](../admin/webhook-configuration.md) - 웹훅 시스템 이해 (관리자 문서)
- [태그 이벤트 모니터링](tag-event-monitoring.md) - 이벤트와 웹훅의 연계
- [웹훅 시스템](../../feature-guides/webhook-system.md) - 웹훅 아키텍처 이해
